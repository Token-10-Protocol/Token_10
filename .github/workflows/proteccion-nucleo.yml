name: üîí Protecci√≥n del N√∫cleo Token 10
on:
  push:
    paths:
      - 'nucleo/**'
  pull_request:
    paths:
      - 'nucleo/**'

jobs:
  escanear-seguridad:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout c√≥digo
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Verificar estructura del n√∫cleo
        run: |
          echo "üîç Verificando estructura del n√∫cleo..."
          ls -la nucleo/
          if [ -f "nucleo/.gitleaks.toml" ]; then
            echo "‚úÖ Gitleaks config encontrado en nucleo/"
            # Copiar la configuraci√≥n a la ra√≠z temporalmente
            cp nucleo/.gitleaks.toml .gitleaks.toml
          else
            echo "‚ùå Gitleaks config NO encontrado"
            exit 1
          fi

      - name: Escanear secrets en el n√∫cleo
        uses: gitleaks/gitleaks-action@v2
        with:
          config-path: .gitleaks.toml
          path: ./nucleo
          no-git: false

      - name: Limpiar configuraci√≥n temporal
        run: |
          rm -f .gitleaks.toml
          echo "‚úÖ Escaneo completado"

      - name: Verificar archivos cr√≠ticos
        run: |
          echo "üìã Verificando archivos cr√≠ticos..."
          CRITICAL_FILES=(
            "nucleo/.acceso/sistema-puntaje.py"
            "nucleo/.gitleaks.toml"
          )
          
          for file in "${CRITICAL_FILES[@]}"; do
            if [ -f "$file" ]; then
              echo "‚úÖ $file - OK"
            else
              echo "‚ùå $file - FALTANTE"
            fi
          done
