name: üîí Protecci√≥n del N√∫cleo Token 10

on:
  push:
    paths:
      - 'nucleo/**'
  pull_request:
    paths:
      - 'nucleo/**'

jobs:
  escanear-seguridad:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout c√≥digo
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Verificar estructura del n√∫cleo
        run: |
          echo "üîç Verificando estructura del n√∫cleo..."
          ls -la nucleo/
          if [ -f "nucleo/.gitleaks.toml" ]; then
            echo "‚úÖ Gitleaks config encontrado"
          else
            echo "‚ùå Gitleaks config NO encontrado"
            exit 1
          fi

      - name: Escanear secrets en el n√∫cleo

        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Verificar archivos cr√≠ticos
        run: |
          echo "üìã Verificando archivos cr√≠ticos..."
          CRITICAL_FILES=(
            "nucleo/sistema-acceso/control-estados/sistema-puntaje.py"
            "nucleo/.gitleaks.toml"
          )
          
          for file in "${CRITICAL_FILES[@]}"; do
            if [ -f "$file" ]; then
              echo "‚úÖ $file - OK"
            else
              echo "‚ùå $file - FALTANTE"
            fi
          done
          echo "‚úÖ Protecci√≥n del n√∫cleo verificada"